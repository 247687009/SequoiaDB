
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="topic"/>
<meta name="DC.Title" content="Data Recovery"/>
<meta name="description" content="Use a replica group data recovery backup. Perform data recovery must ensure that the corresponding group has stopped tunning, data recovery will first clear the original node and log all the data and ..."/>
<meta name="DC.Relation" scheme="URI" content="../../../administration/operation_maintain/topics/bandr_en.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="topic_mns_2z4_fm"/>
<link rel="stylesheet" type="text/css" href="../../../commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../../../assets/webhelp_topic.css"/>
<title>Data Recovery</title>
<script type="text/javascript" src="../../../assets/jquery-1.3.2.js"> </script><script type="text/javascript" src="../../../assets/jquery-ui-1.8.2.custom.min.js"> </script><script type="text/javascript" src="../../../assets/frames_redirect.js"> </script><script type="text/javascript"><!--
    var prefix = "../../../../index.html";
    var ratingFile = "";
    redirectToToc(window.location.search);
    function highlightSearchTerm(){
        if(parent.termsToHighlight != null){
        // highlight each term in the content view  
          for(i = 0 ; i < parent.termsToHighlight.length ; i++){        
              $('*', window.parent.frames[1].document).highlight(parent.termsToHighlight[i]);
          }
        }
    }
//--></script></head>
<body onload="highlightSearchTerm()" id="topic_mns_2z4_fm"><a name="topic_mns_2z4_fm"><!-- --></a>
<table class="nav"><tbody><tr><td><div class="navheader"><span class="frames" onclick="redirectFrames(location.pathname)"><script type="text/javascript"><!--
  if (parent.window.location.pathname == window.location.pathname ) document.write('With Frames');                    
                    --></script></span><a class="link" href="../../../administration/operation_maintain/topics/bandr_en.html" title="Backup and Recovery"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Backup and Recovery</span></a>  </div></td><td width="50%"><a class="navheader_parent_path" href="operation_maintain_en.html" title="Operation and Maintain">Operation and Maintain</a> / <a class="navheader_parent_path" href="../../../administration/operation_maintain/topics/bandr_en.html" title="Backup and Recovery">Backup and Recovery</a></td></tr></tbody></table>

  <h1 class="title topictitle1">Data Recovery</h1>

  <div class="body">    
    <p class="p">Use a replica group data recovery backup. Perform data recovery must ensure that the corresponding group has stopped tunning, data recovery will first clear the original node and log all 
    the data and then restore the data from the backup configuration data and logs.</p>

    <div class="section"><h2 class="title sectiontitle">Data recovery tool Parameter Description</h2>
      
      <table cellpadding="4" cellspacing="0" summary="" border="1" class="simpletable"><tr class="sthead">
          <th valign="bottom" align="left" id="d63686e22" class="stentry">Parameter</th>

          <th valign="bottom" align="left" id="d63686e25" class="stentry">Description</th>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">-p [--bkpath]</td>

          <td valign="top" headers="d63686e25" class="stentry">Backup source where the data path.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">-i [--increaseid]</td>

          <td valign="top" headers="d63686e25" class="stentry">Requires several incremental backups to restore to default back to the last time.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">-n [--bkname]</td>

          <td valign="top" headers="d63686e25" class="stentry">Need to restore the backup name.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">-a [--action]</td>

          <td valign="top" headers="d63686e25" class="stentry">Recovery behavior, "restore" indicates that the recobery, "list" indicates view backup information, defaults to "restore".</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--isSelf</td>

          <td valign="top" headers="d63686e25" class="stentry">Whether to restore the node data, the default is "true", when the value is "false", according to the following parameters to restore the data to the specified path:</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--dbpath</td>

          <td valign="top" headers="d63686e25" class="stentry">Must configure the data file directory.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--confpath</td>

          <td valign="top" headers="d63686e25" class="stentry">Must configure the configuration file path.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--svcname</td>

          <td valign="top" headers="d63686e25" class="stentry">Must configure the local service name or port.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--indexpath</td>

          <td valign="top" headers="d63686e25" class="stentry">Indes file directory.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--logpath</td>

          <td valign="top" headers="d63686e25" class="stentry">Log file directory.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--diagpath</td>

          <td valign="top" headers="d63686e25" class="stentry">Diagnostic log file directory.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--bkuppath</td>

          <td valign="top" headers="d63686e25" class="stentry">Backup file directory.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--replname</td>

          <td valign="top" headers="d63686e25" class="stentry">Copy communications service name or port.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--shardname</td>

          <td valign="top" headers="d63686e25" class="stentry">Slice communications service name or port.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--catalogname</td>

          <td valign="top" headers="d63686e25" class="stentry">Catalog communicatios service name or port.</td>

        </tr>
<tr class="strow">
          <td valign="top" headers="d63686e22" class="stentry">--httpname</td>

          <td valign="top" headers="d63686e25" class="stentry">REST service name or port.</td>

        </tr>
</table>
</div>

    <div class="section"><h2 class="title sectiontitle">Recover Data</h2>
                 
    </div>

    <div class="note note"><span class="notetitle">Note:</span> If a replica group that contains multiple data nodes, you must stop the group and recover each data node. If the data is restored to a non-backup data nodes must use --isSelf false 
    configuration parameters, and set the relevant configuration parameters.</div>

    <ol class="ol">
      <li class="li">Connect to the coord node
        <pre class="pre codeblock">$ /opt/sequoiadb/bin/sdb
&gt; var db = new Sdb("localhost", 11810) ;</pre>
</li>

      <li class="li">Get replica group <pre class="pre codeblock">&gt; datarg = db.getRG ( "data" ) ;</pre>
</li>

      <li class="li">Stop replica group <pre class="pre codeblock">&gt; datarg.stop()</pre>
</li>

      <li class="li">Login via terminal nodes corresponding data replica group, perform data recovery.
        <pre class="pre codeblock">sdbadmin@vmsvr2-suse-x64-1:/opt/sequoiadb&gt; bin/sdbrestore -p  database/11820/bakfile -n test_bk
Begin to clean dps logs...
Begin to clean dms storages...
Begin to init dps logs...
Begin to restore...
Begin to restore data file: 11820/bakfile/test_bk.1 ...
Begin to restore su: test.1.data ...
Begin to restore su: test.1.idx ...
Begin to restore dps logs...
*****************************************************
Restore succeed!
*****************************************************</pre>
</li>

      <li class="li">Check the file to a data node directory is
        restored.<pre class="pre codeblock">sdbadmin @vmsvr2-suse-x64-1:/ opt/sequoiadb /database/11820&gt; ls -l
total 299156
drwxr-xr-x 2 sdbadmin sdbadmin      4096 Nov 13 16:06 bakfile
drwxr-xr-x 2 sdbadmin sdbadmin      4096 Nov 13 15:48 diaglog
drwxr-xr-x 2 sdbadmin sdbadmin      4096 Nov 13 17:39 replicalog
-rw-r----- 1 sdbadmin sdbadmin 155254784 Nov 13 17:39 test.1.data
-rw-r----- 1 sdbadmin sdbadmin 151060480 Nov 13 17:39 test.1.idx</pre>
</li>

      <li class="li">Delete the replica groups other data, all data nodes (or all the nodes. Data and. Idx files are copied to the other data node's data directory and index directory, and copy all the logs that node 
      replicalog to other data nodes log directory, or copy the backup file to another data node, and through the restored tool recovers), restart the system.</li>

    </ol>

  </div>

<div class="related-links"/>
<div class="navfooter"><a class="link" href="../../../administration/operation_maintain/topics/bandr_en.html" title="Backup and Recovery"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Backup and Recovery</span></a>  <script type="text/javascript"><!--         
    function expand(){
        parent.tocwin.expandToTopic(window.location.href, this.getAttribute('href'));
    }
    var aArray = document.getElementsByTagName('a');
    var i;
    for (i = 0; i< aArray.length; i++){
      aArray[i].onclick = expand;
    }
//--></script></div><div class="footer"><a href="http://www.sequoiadb.com" target="_blank"><img src="../../../assets/images/sequoiadb_logo.png" alt="SequoiaDB"/></a>SequoiaDB Version 1.11
          
    </div>
</body>
</html>